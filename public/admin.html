<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Admin Upload</title>
</head>
<body>
  
<h2>Créer un produit</h2>

<input id="id" placeholder="ID produit" />
<input id="name" placeholder="Nom" />
<input id="price" type="number" placeholder="Prix" />
<input id="category" placeholder="Catégorie" />
<input type="file" id="imageInput" />
<button id="uploadBtn">Uploader image</button>

<p id="imageUrl"></p>

<button id="saveProduct">Sauvegarder produit</button>




<script>
const ADMIN_KEY = "1234";

let uploadedImageUrl = "";

document.getElementById("uploadBtn").onclick = async () => {
  const file = imageInput.files[0];
  if (!file) return alert("Choisis une image");

  const formData = new FormData();
  formData.append("image", file);

  const res = await fetch("/admin/upload-image", {
    method: "POST",
    headers: {
      "x-admin-key": ADMIN_KEY
    },
    body: formData
  });

  const data = await res.json();
  uploadedImageUrl = data.imageUrl;
  imageUrl.textContent = uploadedImageUrl;
};

document.getElementById("saveProduct").onclick = async () => {
  if (!uploadedImageUrl) return alert("Upload l'image d'abord");

  const product = {
    id: id.value,
    name: name.value,
    category: category.value,
    price: Number(price.value),
    image: uploadedImageUrl,
    images: [uploadedImageUrl],   // compatibilité galerie
    options: {},
    lieuDeLIvraison: { ville: ["Kinshasa", "Goma", "Lubumbashi", "Kampala"] }
  };

  const res = await fetch("/admin/add-product", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-key": ADMIN_KEY
    },
    body: JSON.stringify(product)
  });

  const data = await res.json();
  alert("Produit ajouté ✔");
};
</script>
</body>
</html>

