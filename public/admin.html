<h2>Créer un produit</h2>

<input id="id" placeholder="ID produit" />
<input id="name" placeholder="Nom" />
<input id="price" type="number" placeholder="Prix" />
<input id="category" placeholder="Catégorie" />
<input type="file" id="imageInput" />
<button id="uploadBtn">Uploader image</button>

<p id="imageUrl"></p>

<button id="saveProduct">Sauvegarder produit</button>

<script>

const ADMIN_KEY = "1234"; // même clé que dans Render env

const res = await fetch("/admin/upload-image", {
  method: "POST",
  headers: { "x-admin-key": ADMIN_KEY },
  body: formData
});


let uploadedImageUrl = "";

document.getElementById("uploadBtn").onclick = async () => {
  const file = imageInput.files[0];
  const formData = new FormData();
  formData.append("image", file);

  const res = await fetch("/admin/upload-image", {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  uploadedImageUrl = data.imageUrl;
  imageUrl.textContent = uploadedImageUrl;
};

document.getElementById("saveProduct").onclick = async () => {
  const product = {
    id: id.value,
    name: name.value,
    category: category.value,
    price: Number(price.value),
    image: uploadedImageUrl,
    options: {},
    lieuDeLIvraison: { ville: ["Kinshasa"] }
  };

  await fetch("/admin/add-product", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(product)
  });

  alert("Produit ajouté");
};
</script>
